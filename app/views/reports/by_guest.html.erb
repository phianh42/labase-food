<!-- app/views/reports/by_guest.html.erb -->
<h1 class="text-4xl font-bold uppercase mb-8 border-b-4 border-black pb-2">
  Recipe History: <%= @guest.name %>
</h1>

<div class="mb-8 grid grid-cols-1 md:grid-cols-3 gap-4">
  <div class="border-2 border-black p-4">
    <p class="text-2xl font-bold"><%= @guest.meals_attended_count %></p>
    <p class="uppercase">Meals Attended</p>
  </div>
  <div class="border-2 border-black p-4">
    <p class="text-2xl font-bold"><%= @guest.recipes_tried.count %></p>
    <p class="uppercase">Unique Recipes Tried</p>
  </div>
  <div class="border-2 border-black p-4">
    <p class="text-2xl font-bold"><%= @recipes_history.count %></p>
    <p class="uppercase">Total Servings</p>
  </div>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 gap-8">
  <div>
    <h2 class="text-2xl font-bold uppercase mb-4 border-b-2 border-black pb-2">Recipe Frequency</h2>
    <div class="space-y-2">
      <% @recipe_counts.first(10).each do |recipe_id, count| %>
        <% recipe = Recipe.find(recipe_id) %>
        <div class="border border-black p-2 flex justify-between">
          <span><%= link_to recipe.title, recipe_path(recipe), class: "hover:underline" %></span>
          <span class="font-bold"><%= count %>x</span>
        </div>
      <% end %>
    </div>
  </div>
  
  <div>
    <h2 class="text-2xl font-bold uppercase mb-4 border-b-2 border-black pb-2">Recent History</h2>
    <div class="space-y-4">
      <% @recipes_history.limit(10).each do |course_recipe| %>
        <div class="border border-black p-3">
          <p class="font-bold">
            <%= link_to course_recipe.recipe.title, recipe_path(course_recipe.recipe), class: "hover:underline" %>
          </p>
          <p class="text-sm uppercase">
            <%= course_recipe.course.meal.display_name %>
          </p>
          <% if course_recipe.comments.present? %>
            <p class="text-sm italic mt-1"><%= course_recipe.comments %></p>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
</div>

<div class="mt-8">
  <%= paginate @recipes_history %>
</div>


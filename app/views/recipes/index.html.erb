<!-- app/views/recipes/index.html.erb -->
<h1 class="text-4xl font-bold uppercase mb-8 border-b-4 border-black pb-2">
  <%= params[:tag].present? ? "Recipes tagged: #{params[:tag]}" : "Recettes" %>
</h1>

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
  <% @recipes.each do |recipe| %>
    <div class="border-4 border-black relative">
      <% if params[:my_recipes].present? %>
        <!-- In "My Recipes" view: only show privacy indicator -->
        <% unless recipe.is_public? %>
          <div class="absolute top-2 right-2 z-10">
            <span class="bg-red-600 text-white px-3 py-1 text-xs uppercase font-bold">
              PRIVÃ‰E
            </span>
          </div>
        <% end %>
      <% else %>
        <!-- In public view: show "MA RECETTE" for own recipes -->
        <% if user_signed_in? && recipe.user == current_user %>
          <div class="absolute top-2 right-2 z-10">
            <span class="bg-black text-white px-3 py-1 text-xs uppercase font-bold">
              MA RECETTE
            </span>
          </div>
        <% end %>
      <% end %>
      
      <% if recipe.image.attached? %>
        <%= image_tag recipe.image, class: "w-full h-48 object-cover" %>
      <% else %>
        <div class="w-full h-48 bg-gray-200 flex items-center justify-center">
          <span class="text-4xl uppercase">No Image</span>
        </div>
      <% end %>
      
      <div class="p-4">
        <h2 class="text-xl font-bold uppercase mb-2">
          <%= link_to recipe.title, recipe, class: "hover:underline" %>
        </h2>
        
        <div class="text-sm uppercase mb-2">
          <%= recipe.user.username %> | <%= recipe.created_at.strftime("%Y-%m-%d") %>
        </div>
        
        <div class="flex gap-4 text-sm uppercase mb-2">
          <% if recipe.preparation_time.present? %>
            <span>PREP: <%= recipe.preparation_time %>MIN</span>
          <% end %>
          <% if recipe.cooking_time.present? %>
            <span>COOK: <%= recipe.cooking_time %>MIN</span>
          <% end %>
        </div>
        
        <!-- Recipe tags -->
        <% if recipe.tags.any? %>
          <div class="flex flex-wrap gap-1 mt-2">
            <% recipe.tags.limit(3).each do |tag| %>
              <span class="bg-gray-800 text-white px-2 py-1 text-xs uppercase">
                <%= tag.name %>
              </span>
            <% end %>
            <% if recipe.tags.count > 3 %>
              <span class="text-xs text-gray-600 px-2 py-1">
                +<%= recipe.tags.count - 3 %>
              </span>
            <% end %>
          </div>
        <% end %>
        
        <!-- Action buttons for own recipes -->
        <% if user_signed_in? && recipe.user == current_user %>
          <div class="flex gap-2 mt-3">
            <%= link_to "MODIFIER", edit_recipe_path(recipe), 
                class: "text-xs border border-black px-2 py-1 uppercase hover:bg-black hover:text-white" %>
            <%= link_to "VOIR", recipe, 
                class: "text-xs border border-gray-600 px-2 py-1 uppercase hover:bg-gray-600 hover:text-white" %>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
</div>

<div class="mt-8 flex justify-center">
  <%= paginate @recipes if respond_to?(:paginate) %>
</div>
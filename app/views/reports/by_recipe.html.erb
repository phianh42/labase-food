<!-- app/views/reports/by_recipe.html.erb -->
<h1 class="text-4xl font-bold uppercase mb-8 border-b-4 border-black pb-2">
  Guest History: <%= @recipe.title %>
</h1>

<div class="mb-8 grid grid-cols-1 md:grid-cols-3 gap-4">
  <div class="border-2 border-black p-4">
    <p class="text-2xl font-bold"><%= @recipe.times_served %></p>
    <p class="uppercase">Times Served</p>
  </div>
  <div class="border-2 border-black p-4">
    <p class="text-2xl font-bold"><%= @guest_counts.count %></p>
    <p class="uppercase">Different Guests</p>
  </div>
  <div class="border-2 border-black p-4">
    <p class="text-2xl font-bold"><%= @serving_history.count %></p>
    <p class="uppercase">Total Servings</p>
  </div>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 gap-8">
  <div>
    <h2 class="text-2xl font-bold uppercase mb-4 border-b-2 border-black pb-2">Guest Frequency</h2>
    <div class="space-y-2">
      <% @guest_counts.first(10).each do |guest_id, count| %>
        <% guest = Guest.find(guest_id) %>
        <div class="border border-black p-2 flex justify-between">
          <span>
            <%= link_to guest.name, guest_path(guest), class: "hover:underline" %>
            <% if guest.is_household_member? %>
              <span class="text-xs bg-black text-white px-1">HH</span>
            <% end %>
          </span>
          <span class="font-bold"><%= count %>x</span>
        </div>
      <% end %>
    </div>
  </div>
  
  <div>
    <h2 class="text-2xl font-bold uppercase mb-4 border-b-2 border-black pb-2">Serving History</h2>
    <div class="space-y-4">
      <% @serving_history.limit(10).each do |course_recipe| %>
        <div class="border border-black p-3">
          <p class="font-bold uppercase">
            <%= course_recipe.course.meal.display_name %>
          </p>
          <p class="text-sm">
            Course: <%= course_recipe.course.name %>
          </p>
          <p class="text-sm">
            Guests: <%= course_recipe.course.meal.guests.pluck(:name).join(", ") %>
          </p>
          <% if course_recipe.comments.present? %>
            <p class="text-sm italic mt-1"><%= course_recipe.comments %></p>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
</div>

<div class="mt-8">
  <%= paginate @serving_history %>
</div>